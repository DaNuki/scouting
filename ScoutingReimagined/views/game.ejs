<!DOCTYPE html>
<html lang="en">

<head>
    <% include templates/head.ejs %>
</head>

<body>
<!-- START PAGE CONTAINER -->
<div class="page-container page-navigation-toggled">

    <% include templates/sidebar.ejs %>

    <!-- PAGE CONTENT -->
    <div class="page-content">

        <% include templates/xnavigation.ejs %>


        <!-- PAGE CONTENT WRAPPER -->
        <div class="page-content-wrap">
            <div class="row" style="padding-top: 1%">
                <div class="col-md-9 col-lg-9 col-xl-9 col-sm-9 col-xs-9">
                    <video id="gameVideo" style="display: block; margin: auto; width:70vw; height:80vh; margin-bottom: 1vh;" controls muted>
                        Your browser does not support the video tag.
                    </video>
                </div>
                <div class="col-md-3 col-lg-3 col-xl-3 col-sm-3 col-xs-3">
                    <ul id="timeline" class="timeline pre-scrollable">
                        <!-- <li>
                          <div class="timeline-badge"><i class="glyphicon glyphicon-check"></i></div>
                          <div class="timeline-panel">
                            <div class="timeline-heading">
                              <h4 class="timeline-title">Mussum ipsum cacilds</h4>
                              <p><small class="text-muted"><i class="glyphicon glyphicon-time"></i> 11 hours ago via Twitter</small></p>
                            </div>
                            <div class="timeline-body">
                              <p>Mussum ipsum cacilds, vidis litro abertis. Consetis adipiscings elitis. Pra lá , depois divoltis porris, paradis. Paisis, filhis, espiritis santis. Mé faiz elementum girarzis, nisi eros vermeio, in elementis mé pra quem é amistosis quis leo. Manduma pindureta quium dia nois paga. Sapien in monti palavris qui num significa nadis i pareci latim. Interessantiss quisso pudia ce receita de bolis, mais bolis eu num gostis.</p>
                            </div>
                          </div>
                        </li>
                        <li class="timeline-inverted">
                          <div class="timeline-badge warning"><i class="glyphicon glyphicon-credit-card"></i></div>
                          <div class="timeline-panel">
                            <div class="timeline-heading">
                              <h4 class="timeline-title">Mussum ipsum cacilds</h4>
                            </div>
                            <div class="timeline-body">
                              <p>Mussum ipsum cacilds, vidis litro abertis. Consetis adipiscings elitis. Pra lá , depois divoltis porris, paradis. Paisis, filhis, espiritis santis. Mé faiz elementum girarzis, nisi eros vermeio, in elementis mé pra quem é amistosis quis leo. Manduma pindureta quium dia nois paga. Sapien in monti palavris qui num significa nadis i pareci latim. Interessantiss quisso pudia ce receita de bolis, mais bolis eu num gostis.</p>
                              <p>Suco de cevadiss, é um leite divinis, qui tem lupuliz, matis, aguis e fermentis. Interagi no mé, cursus quis, vehicula ac nisi. Aenean vel dui dui. Nullam leo erat, aliquet quis tempus a, posuere ut mi. Ut scelerisque neque et turpis posuere pulvinar pellentesque nibh ullamcorper. Pharetra in mattis molestie, volutpat elementum justo. Aenean ut ante turpis. Pellentesque laoreet mé vel lectus scelerisque interdum cursus velit auctor. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam ac mauris lectus, non scelerisque augue. Aenean justo massa.</p>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="timeline-badge danger"><i class="glyphicon glyphicon-credit-card"></i></div>
                          <div class="timeline-panel">
                            <div class="timeline-heading">
                              <h4 class="timeline-title">Mussum ipsum cacilds</h4>
                            </div>
                            <div class="timeline-body">
                              <p>Mussum ipsum cacilds, vidis litro abertis. Consetis adipiscings elitis. Pra lá , depois divoltis porris, paradis. Paisis, filhis, espiritis santis. Mé faiz elementum girarzis, nisi eros vermeio, in elementis mé pra quem é amistosis quis leo. Manduma pindureta quium dia nois paga. Sapien in monti palavris qui num significa nadis i pareci latim. Interessantiss quisso pudia ce receita de bolis, mais bolis eu num gostis.</p>
                            </div>
                          </div>
                        </li>
                        <li class="timeline-inverted">
                          <div class="timeline-panel">
                            <div class="timeline-heading">
                              <h4 class="timeline-title">Mussum ipsum cacilds</h4>
                            </div>
                            <div class="timeline-body">
                              <p>Mussum ipsum cacilds, vidis litro abertis. Consetis adipiscings elitis. Pra lá , depois divoltis porris, paradis. Paisis, filhis, espiritis santis. Mé faiz elementum girarzis, nisi eros vermeio, in elementis mé pra quem é amistosis quis leo. Manduma pindureta quium dia nois paga. Sapien in monti palavris qui num significa nadis i pareci latim. Interessantiss quisso pudia ce receita de bolis, mais bolis eu num gostis.</p>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="timeline-badge info"><i class="glyphicon glyphicon-floppy-disk"></i></div>
                          <div class="timeline-panel">
                            <div class="timeline-heading">
                              <h4 class="timeline-title">Mussum ipsum cacilds</h4>
                            </div>
                            <div class="timeline-body">
                              <p>Mussum ipsum cacilds, vidis litro abertis. Consetis adipiscings elitis. Pra lá , depois divoltis porris, paradis. Paisis, filhis, espiritis santis. Mé faiz elementum girarzis, nisi eros vermeio, in elementis mé pra quem é amistosis quis leo. Manduma pindureta quium dia nois paga. Sapien in monti palavris qui num significa nadis i pareci latim. Interessantiss quisso pudia ce receita de bolis, mais bolis eu num gostis.</p>
                              <hr>
                              <div class="btn-group">
                                <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">
                                  <i class="glyphicon glyphicon-cog"></i> <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                  <li><a href="#">Action</a></li>
                                  <li><a href="#">Another action</a></li>
                                  <li><a href="#">Something else here</a></li>
                                  <li class="divider"></li>
                                  <li><a href="#">Separated link</a></li>
                                </ul>
                              </div>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="timeline-panel">
                            <div class="timeline-heading">
                              <h4 class="timeline-title">Mussum ipsum cacilds</h4>
                            </div>
                            <div class="timeline-body">
                              <p>Mussum ipsum cacilds, vidis litro abertis. Consetis adipiscings elitis. Pra lá , depois divoltis porris, paradis. Paisis, filhis, espiritis santis. Mé faiz elementum girarzis, nisi eros vermeio, in elementis mé pra quem é amistosis quis leo. Manduma pindureta quium dia nois paga. Sapien in monti palavris qui num significa nadis i pareci latim. Interessantiss quisso pudia ce receita de bolis, mais bolis eu num gostis.</p>
                            </div>
                          </div>
                        </li>
                        <li class="timeline-inverted">
                          <div class="timeline-badge success"><i class="glyphicon glyphicon-thumbs-up"></i></div>
                          <div class="timeline-panel">
                            <div class="timeline-heading">
                              <h4 class="timeline-title">Mussum ipsum cacilds</h4>
                            </div>
                            <div class="timeline-body">
                              <p>Mussum ipsum cacilds, vidis litro abertis. Consetis adipiscings elitis. Pra lá , depois divoltis porris, paradis. Paisis, filhis, espiritis santis. Mé faiz elementum girarzis, nisi eros vermeio, in elementis mé pra quem é amistosis quis leo. Manduma pindureta quium dia nois paga. Sapien in monti palavris qui num significa nadis i pareci latim. Interessantiss quisso pudia ce receita de bolis, mais bolis eu num gostis.</p>
                            </div>
                          </div>
                        </li> -->
                    </ul>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">

                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div class="form-group">
                                <div class="col-sm-2">
                                    <button id="shooting" class="btn btn-info btn-block hidden" style="height: 10vh; font-size: xx-large" onclick="shooting_start()">Shooting</button>
                                </div>
                                <div class="col-sm-2">
                                    <button id="pickup" class="btn btn-info btn-block hidden" style="height: 10vh; font-size: xx-large" onclick="pickup_start()">Pick Up</button>
                                </div>
                                <div class="col-sm-2">
                                    <button id="gearplace" class="btn btn-info btn-block hidden" style="height: 10vh; font-size: xx-large" onclick="gearplace_start()">Gear Place</button>
                                </div>
                                <div class="col-sm-2">
                                    <button id="chassisfight" class="btn btn-info btn-block hidden" style="height: 10vh; font-size: xx-large" onclick="chassisFight_start()">Fight</button>
                                </div>
                                <div class="col-sm-2">
                                    <button id="climb" class="btn btn-info btn-block hidden" style="height: 10vh; font-size: xx-large" onclick="climb_start()">Climb</button>
                                </div>
                                <div class="col-sm-2">
                                    <button id="stuck" class="btn btn-info btn-block hidden" style="height: 10vh; font-size: xx-large" onclick="stuck_start()">Stuck</button>
                                </div>
                                <div id="eventsDiv" style="width: 100%; height:10vh;">
                                    <div class="col-md-12">
                                        <button id="autonomous_begin" class="btn btn-info btn-block btn-default" style="height: 10vh; font-size: xx-large" onclick="autonomous_start()">Autonomous begin</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>
        <!-- END PAGE CONTENT WRAPPER -->
    </div>
    <!-- END PAGE CONTENT -->
</div>
<!-- END PAGE CONTAINER -->

<% include templates/logoutMessagebox.ejs %>

<% include templates/footer.ejs%>

<script type="text/javascript">
    var gameId = <%- JSON.stringify(gameId) %>;
    var teamNumber = <%- JSON.stringify(teamNumber) %>;

    var gameVideo = document.getElementById("gameVideo");

    var blueTeams = <%- JSON.stringify(blueTeams) %>;
    var redTeams = <%- JSON.stringify(redTeams) %>;

    var buttonClickEvent = {};
    var onEnterKeyClick = function(){};

    var autonomousStartTime = null;
</script>
<script src="/js/scouting/binary.js"></script>
<script src="/js/scouting/common.js"></script>
<script src="/js/scouting/video.js"></script>
<script src="/js/scouting/main.js"></script>

<script type="text/javascript" src="/js/scouting/events/shootingEventsHandling.js"></script>
<script type="text/javascript" src="/js/scouting/events/pickupEventsHandling.js"></script>
<script type="text/javascript" src="/js/scouting/events/gearplaceEventsHandling.js"></script>
<script type="text/javascript" src="/js/scouting/events/chassisFightEventsHandling.js"></script>
<script type="text/javascript" src="/js/scouting/events/climbEventsHandling.js"></script>
<script type="text/javascript" src="/js/scouting/events/stuckEventsHandling.js"></script>
<script type="text/javascript" src="/js/scouting/events/autonomousEventsHandling.js"></script>

<script type="text/javascript" src="/js/scouting/events/timeline/utils.js"></script>


<script>
    buttonIds = ['shooting', 'pickup', 'gearplace', 'chassisfight', 'climb', 'stuck'];


    function isFunction(functionToCheck) {
        console.log("Is function?")
        var getType = {};
        return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';
    }
    function hideAllButtons() {
        buttonIds.forEach(function(buttonId) {
            $('#' + buttonId).addClass('hidden');
        })
    }

    function showEventButtons() {
        buttonIds.forEach(function(buttonId) {
            $('#' + buttonId).removeClass('hidden');
        })
    }


    function initializeButtonClickEvent() {
        buttonClickEvent = {
            1: shooting_start,
            2: pickup_start,
            3: gearplace_start,
            4: chassisFight_start,
            5: climb_start,
            6: stuck_start
        }
    }

    function resetButtonClickEvents() {
        buttonClickEvent = {};
    }


    $(window).keypress(function(e) {
        var video = document.getElementById("gameVideo");
        if (e.which == 32 && e.target == document.body) {
            e.preventDefault();
            if (video.paused == true)
                video.play();
            else
                video.pause();
            return;
        }
        if (e.which == 13) {
            console.log("Clicked enter!");
            onEnterKeyClick();
        }
        var VALUE_OF_KEY_1 = 49;
        for(var i = 0; i < 6; i++) {
            if (e.which == (VALUE_OF_KEY_1 + i) && e.target == document.body
                && isFunction(buttonClickEvent[i+1])) {
                    buttonClickEvent[i + 1]()
            }
        }
    });

    // objects = {type: 'BUTTON'||'SELECT', value: value}
    function fillEventsDivWithObjects(objects, functionToCallWhenDone) {
        var eventsDiv = $('#eventsDiv');
        eventsDiv.empty();

        var gridSize = parseInt(12 / objects.length); // Bootstrap columns grid works on size 12
        var colClass = 'col-md-' + gridSize;

        var buttonIndex = 1;

        resetButtonClickEvents();

        objects.forEach(function(object) {
            if (!object['type'] || !object['value']) {
                console.error("Error got wrong form of objects in function fillEventsDivWithObjects! wrong format: " + objects);
                return;
            }
            var element = null;
            switch (object.type) {
                case 'button':
                    element = document.createElement("div");
                    element.className = colClass;
                    var button = document.createElement("button")
                    button.className = "btn btn-info btn-block event-button";
                    var heightText = document.createTextNode(object.value);
                    button.appendChild(heightText);
                    button.addEventListener("click", function() {functionToCallWhenDone(object.value)} );
                    element.appendChild(button);

                    // key value of '1': 49
                    buttonClickEvent[buttonIndex++] = function() { functionToCallWhenDone(object.value) };

                    break;
                case 'select':
                    //Create and append select list
                    element = document.createElement("select");
                    element.className = colClass + ' event-button';
                    element.id = "shootingFailureSelect";

                    //Create and append the options
                    object.value.forEach(function(optionValue) {
                        var option = document.createElement("option");
                        option.value = optionValue;
                        option.text = optionValue;
                        element.appendChild(option);
                    });

                    $(element).on('change', function() {
                        functionToCallWhenDone(this.value);
                    })
                    break;
            }

            eventsDiv.append(element);
        });

        eventsDiv.removeClass('hidden')
    }


    function hideEventsDiv() {
        var eventsDiv = $('#eventsDiv');
        eventsDiv.empty();
        eventsDiv.addClass('hidden');
    }

    function initializeEvents() {
        hideEventsDiv();
        showEventButtons();
        initializeButtonClickEvent();
    }

    function sendEvent(event) {
        addEventToTimeline(event);
        console.log('Sending event: ' + JSON.stringify(event));
        $.ajax({
            type: "POST",
            url: '/event',
            data: event
        });
    }

</script>

<script>
    onEnterKeyClick = autonomous_start;
</script>


</body>

</html>
