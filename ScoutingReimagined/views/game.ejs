<!DOCTYPE html>
<html lang="en">

<head>
    <% include templates/head.ejs %>
</head>

<body>
<!-- START PAGE CONTAINER -->
<div class="page-container page-navigation-toggled">

    <% include templates/sidebar.ejs %>

    <!-- PAGE CONTENT -->
    <div class="page-content">

        <% include templates/xnavigation.ejs %>


        <!-- PAGE CONTENT WRAPPER -->
        <div class="page-content-wrap">

            <div class="row">
                <div class="col-md-12">

                    <div class="panel panel-default">
                        <div class="panel-body">
                            <video id="gameVideo" style="display: block; margin: auto; width:70vw; height:80vh; margin-bottom: 1vh;" controls muted>
                                Your browser does not support the video tag.
                            </video>

                            <div class="form-group">
                                <div class="col-sm-2">
                                    <button id="shooting" class="btn btn-info btn-block" style="height: 10vh; font-size: xx-large" onclick="shooting_start()">Shooting</button>
                                </div>
                                <div class="col-sm-2">
                                    <button id="pickup" class="btn btn-info btn-block" style="height: 10vh; font-size: xx-large" onclick="pickup_start()">Pick Up</button>
                                </div>
                                <div class="col-sm-2">
                                    <button id="gearplace" class="btn btn-info btn-block" style="height: 10vh; font-size: xx-large" onclick="gearplace_start()">Gear Place</button>
                                </div>
                                <div class="col-sm-2">
                                    <button id="chassisfight" class="btn btn-info btn-block" style="height: 10vh; font-size: xx-large">Fight</button>
                                </div>
                                <div class="col-sm-2">
                                    <button id="climb" class="btn btn-info btn-block" style="height: 10vh; font-size: xx-large" onclick="climb_start()">Climb</button>
                                </div>
                                <div class="col-sm-2">
                                    <button id="stuck" class="btn btn-info btn-block" style="height: 10vh; font-size: xx-large" onclick="stuck_start()">Stuck</button>
                                </div>
                                <div id="eventsDiv" style="width: 100%; height:10vh;" class="hidden">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>
        <!-- END PAGE CONTENT WRAPPER -->
    </div>
    <!-- END PAGE CONTENT -->
</div>
<!-- END PAGE CONTAINER -->

<% include templates/logoutMessagebox.ejs %>

<% include templates/footer.ejs%>

<script type="text/javascript">
    var gameId = <%- JSON.stringify(gameId) %>;
    var teamNumber = <%- JSON.stringify(teamNumber) %>;
</script>
<script src="/js/scouting/binary.js"></script>
<script src="/js/scouting/common.js"></script>
<script src="/js/scouting/video.js"></script>
<script src="/js/scouting/main.js"></script>


<script type="text/javascript" src="/js/scouting/events/shootingEventsHandling.js"></script>
<script type="text/javascript" src="/js/scouting/events/pickupEventsHandling.js"></script>
<script type="text/javascript" src="/js/scouting/events/gearplaceEventsHandling.js"></script>
<script type="text/javascript" src="/js/scouting/events/chassisFightEventsHandling.js"></script>
<script type="text/javascript" src="/js/scouting/events/climbEventsHandling.js"></script>
<script type="text/javascript" src="/js/scouting/events/stuckEventsHandling.js"></script>

<script>
    buttonIds = ['shooting', 'pickup', 'gearplace', 'chassisfight', 'climb', 'stuck'];


    function hideAllButtons() {
        buttonIds.forEach(function(buttonId) {
            $('#' + buttonId).addClass('hidden');
        })
    }

    function showEventButtons() {
        buttonIds.forEach(function(buttonId) {
            $('#' + buttonId).removeClass('hidden');
        })
    }

    var buttonClickEvent = {}

    function initializeButtonClickEvent() {
        buttonClickEvent = {
            1: shooting_start,
            2: pickup_start,
            3: gearplace_start,
            4: function(){},
            5: climb_start,
            6: stuck_start
        }
    }

    initializeButtonClickEvent();

    $(window).keypress(function(e) {
        var video = document.getElementById("gameVideo");
        if (e.which == 32 && e.target == document.body) {
            e.preventDefault();
            if (video.paused == true)
                video.play();
            else
                video.pause();
            return;
        }
        var VALUE_OF_KEY_1 = 49;
        for(var i = 0; i < 6; i++) {
            if (e.which == (VALUE_OF_KEY_1 + i) && e.target == document.body) {
                buttonClickEvent[i+1]();
            }
        }
    });

    // objects = {type: 'BUTTON'||'SELECT', value: value}
    function fillEventsDivWithObjects(objects, functionToCallWhenDone) {
        var eventsDiv = $('#eventsDiv');
        eventsDiv.empty();

        var gridSize = parseInt(12 / objects.length); // Bootstrap columns grid works on size 12
        var colClass = 'col-md-' + gridSize;

        var buttonIndex = 1;

        objects.forEach(function(object) {
            if (!object['type'] || !object['value']) {
                console.error("Error got wrong form of objects in function fillEventsDivWithObjects! wrong format: " + objects);
                return;
            }
            var element = null;
            switch (object.type) {
                case 'button':
                    element = document.createElement("div");
                    element.className = colClass;
                    var button = document.createElement("button")
                    button.className = "btn btn-info btn-block event-button";
                    var heightText = document.createTextNode(object.value);
                    button.appendChild(heightText);
                    button.addEventListener("click", function() {functionToCallWhenDone(object.value)} );
                    element.appendChild(button);

                    // key value of '1': 49
                    buttonClickEvent[buttonIndex++] = function() { functionToCallWhenDone(object.value) };

                    break;
                case 'select':
                    //Create and append select list
                    element = document.createElement("select");
                    element.className = colClass + ' event-button';
                    element.id = "shootingFailureSelect";

                    //Create and append the options
                    object.value.forEach(function(optionValue) {
                        var option = document.createElement("option");
                        option.value = optionValue;
                        option.text = optionValue;
                        element.appendChild(option);
                    });

                    $(element).on('change', function() {
                        functionToCallWhenDone(this.value);
                    })
                    break;
            }

            eventsDiv.append(element);
        });

        eventsDiv.removeClass('hidden')
    }


    function hideEventsDiv() {
        var eventsDiv = $('#eventsDiv');
        eventsDiv.empty();
        eventsDiv.addClass('hidden');
    }

    function initializeEvents() {
        hideEventsDiv();
        showEventButtons();
        initializeButtonClickEvent();
    }

    function sendEvent(event) {
        console.log('Sending event: ' + JSON.stringify(event));

        //TODO really send event
    }
</script>
</body>

</html>
